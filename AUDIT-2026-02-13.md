# ğŸ° Clawd Control Dashboard - Full Audit Report
**Date:** 2026-02-13  
**Project:** http://vens-mac-mini:3100 (Clawd Control / Ven Agents Dashboard)  
**Location:** `/Users/venagency/clawd-control/`

---

## ğŸ“‹ Executive Summary

**Project Status:** âœ… Mostly Functional (but with critical bugs)
- **What it is:** Real-time monitoring dashboard for OpenClaw/Clawdbot AI agents
- **What works:** Dashboard, authentication, most pages load, real-time SSE updates
- **What's broken:** Crons page, Traces page, hardcoded paths, missing security page link
- **Recent fix:** Analytics timestamp comparison bug fixed (BUGFIX-2026-02-13.md)

---

## ğŸ“Š Pages & Tools Inventory

### âœ… Working Pages (HTML loads, no critical errors):
1. **`/` (dashboard.html)** - Fleet overview, agent cards, host metrics  
2. **`/tokens.html`** - Token usage analytics (but shows 0 data - see issues)  
3. **`/analytics.html`** - Cost analytics  
4. **`/waterfall.html`** - Session waterfall view  
5. **`/create.html`** - Agent creation wizard  
6. **`/agent-detail.html`** - Individual agent deep dive (includes security audit)  

### âŒ Broken/Partially Broken:
7. **`/crons.html`** - **BROKEN**: API fails with `ENOENT: clawdbot command not found`  
8. **`/traces.html`** - **BROKEN**: Backend looks for wrong directory (`.clawdbot` vs `.openclaw`)  

### ğŸ”§ Infrastructure Pages:
- **`/login`** - âœ… Working (generated inline HTML)  
- No standalone security audit page (embedded in agent-detail.html only)

---

## ğŸ› Issues Found

### ğŸš¨ CRITICAL Issues

#### 1. **Hardcoded `.clawdbot` paths (should be `.openclaw`)**
**Location:** `server.mjs` (8 instances)  
**Lines:** 172, 180, 195, 363, 559, 719, 762, 926  
**Impact:** Breaks features that rely on reading agent session data  
**Affected:**
- Traces page (`/api/traces`)
- Analytics functions (`getAnalytics`, `getTokenAnalytics`, `getTraces`, `getAllSessions`)
- Session management actions

**Example error:**
```
ENOENT: no such file or directory, scandir '/Users/venagency/.clawdbot/agents'
```

**Fix needed:** Replace all `.clawdbot` â†’ `.openclaw`

---

#### 2. **Crons API broken - wrong binary path**
**Error:** `spawnSync /opt/homebrew/Cellar/node/25.6.0/bin/clawdbot ENOENT`  
**Cause:** Looking for `clawdbot` command which doesn't exist (system uses `openclaw`)  
**Location:** `server.mjs:1216` (cron list endpoint)  
**Impact:** Crons page completely non-functional  

**Fix needed:** Change `clawdbot` â†’ `openclaw` in `execFileSync` calls

---

### âš ï¸ MEDIUM Issues

#### 3. **Empty token/analytics data**
**Symptom:** All API endpoints return 0 tokens, 0 calls, 0 cost  
**Possible causes:**
- Recent timestamp bug was fixed, but data might need time to accumulate
- Log files might be in wrong location (also `.clawdbot` vs `.openclaw`)
- Analytics functions may still have path issues

**Needs investigation:** Check if log parsing is working after path fix

---

#### 4. **Missing Security Audit page link**
**Finding:** Security audit exists (`/api/security-audit` works) and shows 2 fails:
- âŒ No secrets/ directory found
- âŒ FileVault is Off

**BUT:** No link to view it in the sidebar!  
**Currently:** Only accessible from agent-detail.html (buried)  

**Fix needed:** Add security audit page to sidebar "Tools" section

---

#### 5. **Hamburger menu confusion**
**Steve said:** "hamburger menu / sidebar is missing"  
**Reality:** Hamburger menu EXISTS (â˜° button in topbar)  
**Possible issues:**
- CSS display issue on Steve's device?
- Menu not visible in collapsed state?
- Feature works but Steve didn't see it?

**Action:** Verify menu visibility on Steve's browser/device

---

### ğŸ’¡ MINOR Issues

#### 6. **No visual indicator for broken pages**
Pages that fail (crons, traces) still load HTML but show loading states forever or generic errors. Users might not realize the feature is broken.

**Suggestion:** Add error states with clear messages when API fails

---

#### 7. **No page title updates**
All pages show "Ven Agents" in browser tab. Should show page-specific titles (e.g., "Cron Jobs - Ven Agents")

---

## ğŸ“ File Structure

```
/Users/venagency/clawd-control/
â”œâ”€â”€ server.mjs              âš ï¸  Hardcoded .clawdbot paths (8Ã—)
â”œâ”€â”€ collector.mjs           ğŸ“¡ Data collector (polls agents)
â”œâ”€â”€ layout.js               âœ… Shared UI (sidebar, topbar, theme)
â”œâ”€â”€ agents.json             âœ… 4 agents configured (tom, brian, sammy, charlie)
â”œâ”€â”€ auth.json               ğŸ” Password: HVwJ9-Er1_lUIIlQ
â”œâ”€â”€ dashboard.html          âœ… Main dashboard
â”œâ”€â”€ tokens.html             âš ï¸  Loads but shows 0 data
â”œâ”€â”€ analytics.html          âœ… Working
â”œâ”€â”€ crons.html              âŒ Broken (wrong binary)
â”œâ”€â”€ traces.html             âŒ Broken (wrong path)
â”œâ”€â”€ waterfall.html          âœ… Working
â”œâ”€â”€ create.html             âœ… Working
â”œâ”€â”€ agent-detail.html       âœ… Working (has security audit)
â”œâ”€â”€ security-lib/           ğŸ”’ Security checks (used by API)
â”œâ”€â”€ logs/
â”‚   â”œâ”€â”€ stderr.log          âš ï¸  Shows getTraces error
â”‚   â””â”€â”€ stdout.log          âœ… Server starts OK
â””â”€â”€ BUGFIX-2026-02-13.md    ğŸ“ Recent timestamp fix
```

---

## ğŸ” What Each Tool Does

| Page | Purpose | Status | Notes |
|------|---------|--------|-------|
| **Dashboard** | Fleet overview, live agent status | âœ… Works | Main landing page |
| **Token Usage** | Detailed token breakdown per agent | âš ï¸ Shows 0 data | API works but no data |
| **Cost Analytics** | Cost tracking, spending trends | âš ï¸ Shows 0 data | API works but no data |
| **Session Waterfall** | Visual timeline of session events | âœ… Works | Timing analysis |
| **Trace View** | Parentâ†’child delegation trees | âŒ Broken | Path issue |
| **Cron Jobs** | View/manage scheduled tasks | âŒ Broken | Binary not found |
| **New Agent** | Agent creation wizard | âœ… Works | Provisions new agents |
| **Agent Detail** | Deep dive into single agent | âœ… Works | Shows workspace files, sessions, security |

---

## ğŸ” Security Audit (Current State)

**Endpoint:** `/api/security-audit` âœ… Works  
**Issues found:** 2 fails

### âŒ Fail 1: No secrets/ directory
**Detail:** "No secrets/ directory found"  
**Severity:** Low (informational)  
**Action:** Create `~/clawd/secrets/` if needed, or suppress check if not using that pattern

### âŒ Fail 2: FileVault Off
**Detail:** "FileVault is Off."  
**Severity:** Medium (disk encryption disabled)  
**Action:** Enable FileVault in System Preferences or acknowledge risk

---

## ğŸ› ï¸ Fixes Needed (Priority Order)

### ğŸ”´ HIGH PRIORITY
1. **Fix hardcoded paths** (`.clawdbot` â†’ `.openclaw` in server.mjs)
   - Impact: Unlocks traces, session management, analytics data
   - Effort: Find & replace (8 occurrences)

2. **Fix crons binary** (`clawdbot` â†’ `openclaw`)
   - Impact: Makes crons page functional
   - Effort: 1-2 line change

### ğŸŸ¡ MEDIUM PRIORITY
3. **Add security audit link to sidebar**
   - Impact: Makes security findings discoverable
   - Effort: Add 1 nav item in layout.js

4. **Investigate empty analytics data**
   - After fixing paths, check if data starts populating
   - May need to restart collector or wait for new logs

### ğŸŸ¢ LOW PRIORITY
5. **Improve error messaging** on broken pages
6. **Add page-specific titles** (browser tabs)
7. **Verify hamburger menu visibility** (might be CSS issue)

---

## ğŸ§ª Test Results

### API Endpoints:
- âœ… `/api/snapshot` - OK
- âœ… `/api/agents` - OK
- âœ… `/api/security-audit` - OK
- âŒ `/api/crons` - ENOENT (clawdbot not found)
- âœ… `/api/analytics` - OK (but returns 0 data)
- âœ… `/api/tokens` - OK (but returns 0 data)
- âœ… `/api/sessions` - OK
- âœ… `/api/traces` - OK (but likely incomplete due to path issue)

### HTML Pages:
- âœ… All pages load (26KB - 35KB each)
- âœ… Authentication works
- âœ… Layout.js injects sidebar + topbar correctly
- âœ… Theme toggle works (localStorage persistence)
- âœ… SSE live updates functional

---

## ğŸ’­ Notes for Steve

**Re: "all tools need work"**
- Most tools actually LOAD and have good UI/UX
- The issues are backend path mismatches (clawdbot â†’ openclaw)
- Once paths are fixed, expect tokens/analytics data to populate
- Crons needs binary path fix
- Security audit is functional but hidden (no sidebar link)

**Re: "tokens.html not working"**
- The PAGE works (loads, renders, has working UI)
- The DATA is empty (0 tokens, 0 calls)
- Likely because analytics log reader is looking in wrong directory

**Re: "hamburger menu missing"**
- â˜° button IS present in topbar (line 395 of layout.js)
- It calls `toggleSidebar()` which works
- Might be a visual/CSS issue or Steve didn't notice it?

**Re: "2 fails on security audit"**
- Secrets directory missing (low severity)
- FileVault off (medium severity)
- Both are system-level, not code bugs

---

## âœ… What's Actually Good

- **Clean architecture:** No build tools, vanilla JS, simple server
- **Recent bug fix:** Timestamp comparison fixed (good maintenance)
- **Auth system:** Working session-based login
- **SSE real-time:** Live updates functional
- **Theme system:** Dark/light mode with persistence
- **Responsive UI:** Clean design, good CSS variables
- **Agent discovery:** Auto-discovers local agents
- **Documentation:** Good README, clear code comments

---

## ğŸ¯ Recommended Action Plan

**Phase 1 (Critical - 30 min):**
1. Global find/replace: `.clawdbot` â†’ `.openclaw` in server.mjs
2. Global find/replace: `clawdbot` â†’ `openclaw` in execFileSync calls
3. Restart server: `launchctl stop local.clawd-control` + start
4. Test traces page, crons page

**Phase 2 (Quick wins - 15 min):**
1. Add security audit link to sidebar (layout.js)
2. Verify analytics data appears (may need to wait for new logs)

**Phase 3 (Polish - 1 hour):**
1. Improve error states on broken pages
2. Add page titles
3. Verify hamburger menu visibility across devices
4. Test create agent wizard
5. Full regression test

---

**End of Audit Report**
